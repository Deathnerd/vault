{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
~}}

<Messages::TabPageHeader
  @authenticated={{@message.authenticated}}
  @pageTitle="{{if @message.isNew 'Create' 'Edit'}} message"
  @breadcrumbs={{this.breadcrumbs}}
/>

<form id="message-create-edit-form" {{on "submit" (perform this.save)}} data-test-form="create-and-edit">
  <div class="box is-sideless is-fullwidth is-marginless has-top-padding-s">
    <Hds::Text::Body @tag="p" class="has-bottom-margin-l" data-test-form-subtext>
      {{if @message.isNew "Create" "Edit"}}
      a custom message for all users when they access a Vault system via the UI.
    </Hds::Text::Body>

    <MessageError @errorMessage={{this.errorBanner}} class="has-top-margin-s" />

    {{#each @message.formFields as |attr|}}
      {{#if (eq attr.name "linkTitle")}}
        <div class="field has-bottom-margin-m">
          <label for="link" class="is-label">Link
            <span class="has-text-grey-400 has-font-weight-normal">(optional)</span></label>
          <div class="control is-flex-between has-gap-m">
            <Input
              @type="text"
              @value={{@message.linkTitle}}
              placeholder="Display text (e.g. Learn more)"
              id="link-title"
              class="input"
              data-test-field="linkTitle"
              {{on "input" (pipe (pick "target.value") (fn (mut @message.linkTitle)))}}
            />
            <Input
              @type="text"
              @value={{@message.linkHref}}
              placeholder="Paste URL (e.g. www.learnmore.com)"
              id="link-href"
              class="input"
              data-test-field="linkHref"
              {{on "input" (pipe (pick "target.value") (fn (mut @message.linkHref)))}}
            />
          </div>
        </div>
      {{else if (eq attr.name "startTime")}}
        <label for="message-start" class="has-text-weight-bold is-size-8">
          Message starts
        </label>
        <Hds::Text::Body @tag="p" @size="200" class="has-bottom-margin-s">
          Defaults to 12:00 a.m. the following day (local timezone).
        </Hds::Text::Body>
        <Input
          @type="datetime-local"
          @value={{this.startTime}}
          class="input has-top-margin-xs is-auto-width is-block"
          name="startTime"
          data-test-input="startTime"
          {{on "input" this.updateDateTime}}
        />
      {{else if (eq attr.name "endTime")}}
        <Hds::Form::Radio::Group @layout="vertical" @name="endTime" class="has-top-margin-l" as |G|>
          <G.Legend>Message expires</G.Legend>
          <G.Radio::Field @id="never" checked @value="never" {{on "change" (fn (mut @message.endTime) "")}} as |F|>
            <F.Label>Never</F.Label>
            <F.HelperText>This message will never expire unless manually deleted by the operator.</F.HelperText>
          </G.Radio::Field>
          <G.Radio::Field @id="specific-date" @value="specificDate" as |F|>
            <F.Label>Specific date</F.Label>
            <F.HelperText>
              This message will expire at midnight (local timezone) at the specific date.
              <div class="control">
                <Input
                  @type="datetime-local"
                  @value={{this.endTime}}
                  class="input has-top-margin-xs is-auto-width"
                  name="endTime"
                  data-test-input="endTime"
                  {{on "input" this.updateDateTime}}
                />
              </div>
            </F.HelperText>
          </G.Radio::Field>
        </Hds::Form::Radio::Group>
      {{else}}
        <FormField
          @attr={{attr}}
          @model={{@message}}
          @modelValidations={{this.modelValidations}}
          class="has-bottom-margin-m"
          data-test-field={{true}}
        />
      {{/if}}
    {{/each}}

    <Hds::ButtonSet class="has-top-margin-s has-bottom-margin-m has-top-margin-xl">
      {{! TODO: VAULT-21533 preview modal }}
      <Hds::Button @text="Preview" @color="tertiary" @icon="eye" />

      <Hds::Button
        @text="{{if @message.isNew 'Create' 'Edit'}} message"
        disabled={{(or this.invalidFormMessage this.save.isRunning)}}
        data-test-button="create-message"
        type="submit"
      />

      <Hds::Button
        @text="Cancel"
        @color="secondary"
        @route="messages.index"
        @query={{hash authenticated=@message.authenticated}}
      />
    </Hds::ButtonSet>
  </div>
</form>